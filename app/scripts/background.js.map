{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":[" /* exported authenticate, unAuthenticate */\n 'use strict';\n\n var ref, userRef, clientID, senderID = '45203521863';\n\n Firebase.enableLogging(false);\n\n function getRandomToken() {\n   // E.g. 8 * 32 = 256 bits token\n   var randomPool = new Uint8Array(32);\n   crypto.getRandomValues(randomPool);\n   var hex = '';\n   for (var i = 0; i < randomPool.length; ++i) {\n     hex += randomPool[i].toString(16);\n   }\n   // E.g. db18458e2782b2b77e36769c569e263a53885a9944dd0a861e5064eac16f1a\n   var token = hex.substring(0, 16);\n   console.log(token);\n   return token;\n }\n\n function setGCMRegId() {\n   chrome.gcm.register([senderID], function(registrationId) {\n     userRef.child('/devices/' + clientID + '/gcm_id').set(registrationId);\n     userRef.child('/devices').once('value', function(dataSnapshot) {\n       dataSnapshot.forEach(function(childSnapshot) {\n         var regId = childSnapshot.child('gcm_id').val();\n         var messageId = getRandomToken();\n         if (regId !== clientID) {\n           var message = {\n             'destinationId': regId,\n             'messageId': messageId,\n             'data': {\n               'action': 'test'\n             }\n           };\n           chrome.gcm.send(message, function() {\n\n           });\n         }\n       });\n     });\n   });\n }\n\n function useToken(userId) {\n   clientID = userId;\n   setGCMRegId();\n }\n\n function setClientId() {\n   chrome.storage.sync.get('clientid', function(items) {\n     var clientid = items.clientid;\n     if (clientid) {\n       useToken(clientid);\n     } else {\n       clientid = getRandomToken();\n       chrome.storage.sync.set({\n         clientid: clientid\n       }, function() {\n         useToken(clientid);\n       });\n     }\n   });\n }\n\n function showSystemNotif(type, iconUrl, title, message, callback) {\n   var notifId = {\n     'type': 'system'\n   };\n   var options = {\n     'type': type,\n     'iconUrl': iconUrl,\n     'title': title,\n     'message': message\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, callback);\n }\n\n function setUpNotificationOnClicks() {\n   chrome.notifications.onClicked.addListener(function(notificationId) {\n     var notifObj = JSON.parse(notificationId);\n     if (notifObj.type === 'device_notif') {\n       //userRef.child('notifications/' + notifObj.fbId).remove();\n     }\n   });\n\n   chrome.notifications.onButtonClicked.addListener(function(notificationId, buttonIndex) {\n     var notifObj = JSON.parse(notificationId);\n     if (notifObj.type === 'device_notif') {\n       if (buttonIndex === 0) {\n         userRef.child('notifications/' + notifObj.fbId).remove();\n         chrome.notifications.clear(notificationId);\n       } else if (buttonIndex === 1) {\n         userRef.child('notifications/' + notifObj.fbId).once('value', function(dataSnapshot) {\n           userRef.child('ignored_apps/' + dataSnapshot.child('package').val()).set(true);\n           chrome.notifications.clear(notificationId);\n         });\n       }\n     }\n   });\n }\n\n function onNewNotification(childSnapshot) {\n   console.log(childSnapshot);\n   //showNotif('basic', 'images/icon-128.png', childSnapshot.child('title').val(), childSnapshot.child('text').val(), null);\n   var notifId = {\n     'type': 'device_notif',\n     'fbId': childSnapshot.key()\n   };\n   var title = childSnapshot.child('title').val();\n   var text = childSnapshot.child('text').val();\n   var options = {\n     'type': 'basic',\n     'iconUrl': 'images/icon-128.png',\n     'title': title !== null ? title : '',\n     'message': text !== null ? text : '',\n     'buttons': [{\n       'title': 'Dismiss'\n     }, {\n       'title': 'Ignore from this app'\n     }]\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, null);\n }\n\n function setUpFirebase(url) {\n   console.log(ref);\n   console.log(url);\n   ref = new Firebase(url);\n }\n\n function setUpFirebaseListen() {\n   if (ref !== undefined) {\n     userRef.child('notifications').off('child_added', onNewNotification);\n     userRef.child('notifications').on('child_added', onNewNotification);\n   }\n }\n\n function setUp() {\n   setClientId();\n   setUpNotificationOnClicks();\n   setUpFirebaseListen();\n }\n\n chrome.runtime.onInstalled.addListener(details => {\n   console.log('previousVersion', details.previousVersion);\n });\n\n // chrome.browserAction.setBadgeText({\n //   text: 'Notiforward'\n // });\n\n // chrome.storage.onChanged.addListener(function(changes, namespace) {\n //   for (var key in changes) {\n //     if (key === 'firebase-url') {\n //       setUpFirebase(changes[key].newValue);\n //       if (ref.getAuth() === null) {\n //         showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n //       } else {\n //         userRef = ref.child(ref.getAuth().uid);\n //         setUpFirebaseListen();\n //       }\n //     }\n //     var storageChange = changes[key];\n //     console.log('Storage key \"%s\" in namespace \"%s\" changed. ' +\n //       'Old value was \"%s\", new value is \"%s\".',\n //       key,\n //       namespace,\n //       storageChange.oldValue,\n //       storageChange.newValue);\n //   }\n // });\n\n chrome.storage.sync.get('firebase-url', function(items) {\n   console.log('syncing settings');\n   if (items['firebase-url'] !== undefined) {\n     setUpFirebase(items['firebase-url']);\n     if (ref.getAuth() === null || ref.getAuth() === undefined) {\n       showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n     } else {\n       userRef = ref.child(ref.getAuth().uid);\n       setUp();\n     }\n   } else {\n     showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n   }\n });\n\n function authenticate(fDb, fUrl, email, pass, $result) {\n   ref = new Firebase(fUrl);\n   console.log('Authing: ' + ref);\n   ref.authWithPassword({\n     'email': email,\n     'password': pass\n   }, function(error, authData) {\n     if (error) {\n       ref = undefined;\n       console.log('Login Failed!', error);\n       $result.html('Authentication Failed');\n     } else {\n       var storages = {\n         'firebase-db': fDb,\n         'firebase-url': fUrl,\n         'firebase-email': email\n       };\n       console.log('Authenticated successfully with payload:', authData);\n       chrome.storage.sync.set(storages, function() {\n         // Notify that we saved.\n         console.log('Settings saved');\n         console.log(storages);\n       });\n       userRef = ref.child(ref.getAuth().uid);\n       showSystemNotif('basic', 'images/icon-128.png', 'Succesful Authentication', 'You will now receive notifications from attatched devices', null);\n       $result.html('Successful Authentication');\n       setUp();\n     }\n   });\n }\n\n function unAuthenticate(wind) {\n   console.log('unauthing');\n   ref.unauth();\n   ref = undefined;\n   userRef = undefined;\n   chrome.storage.sync.remove(['firebase-db', 'firebase-url', 'firebase-email'], function() {\n     console.log('storage removed');\n   });\n   showSystemNotif('basic', 'images/icon-128.png', 'Notiforward Unauthenticated', 'You will no longer receive notifications on this device', null);\n   wind.close();\n }\n"]}