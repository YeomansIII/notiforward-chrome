{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":[" /* exported authenticate, unAuthenticate */\n 'use strict';\n\n var ref, userRef;\n\n Firebase.enableLogging(false);\n\n function showSystemNotif(type, iconUrl, title, message, callback) {\n   var notifId = {\n     'type': 'system'\n   };\n   var options = {\n     'type': type,\n     'iconUrl': iconUrl,\n     'title': title,\n     'message': message\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, callback);\n }\n\n chrome.notifications.onClicked.addListener(function(notificationId) {\n   var notifObj = JSON.parse(notificationId);\n   if (notifObj.type === 'device_notif') {\n     //userRef.child('notifications/' + notifObj.fbId).remove();\n   }\n });\n\n chrome.notifications.onButtonClicked.addListener(function(notificationId, buttonIndex) {\n   var notifObj = JSON.parse(notificationId);\n   if (notifObj.type === 'device_notif') {\n     if (buttonIndex === 0) {\n       userRef.child('notifications/' + notifObj.fbId).remove();\n     } else if (buttonIndex === 1) {\n       userRef.child('notifications/' + notifObj.fbId).once('value', function(dataSnapshot) {\n         userRef.child('ignored_apps/' + dataSnapshot.child('package').val()).set(true);\n       });\n     }\n   }\n });\n\n function onNewNotification(childSnapshot) {\n   console.log(childSnapshot);\n   //showNotif('basic', 'images/icon-128.png', childSnapshot.child('title').val(), childSnapshot.child('text').val(), null);\n   var notifId = {\n     'type': 'device_notif',\n     'fbId': childSnapshot.key()\n   };\n   var title = childSnapshot.child('title').val();\n   var text = childSnapshot.child('text').val();\n   var options = {\n     'type': 'basic',\n     'iconUrl': 'images/icon-128.png',\n     'title': title !== null ? title : '',\n     'message': text !== null ? text : '',\n     'buttons': [{\n       'title': 'Dismiss'\n     }, {\n       'title': 'Ignore from this app'\n     }]\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, null);\n }\n\n function setUpFirebase(url) {\n   console.log(ref);\n   console.log(url);\n   ref = new Firebase(url);\n }\n\n function setUpFirebaseListen() {\n   if (ref !== undefined) {\n     userRef.child('notifications').off('child_added', onNewNotification);\n     userRef.child('notifications').on('child_added', onNewNotification);\n   }\n }\n\n chrome.runtime.onInstalled.addListener(details => {\n   console.log('previousVersion', details.previousVersion);\n });\n\n // chrome.browserAction.setBadgeText({\n //   text: 'Notiforward'\n // });\n\n chrome.storage.onChanged.addListener(function(changes, namespace) {\n   for (var key in changes) {\n     if (key === 'firebase-url') {\n       setUpFirebase(changes[key].newValue);\n       if (ref.getAuth() === null) {\n         showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n       } else {\n         userRef = ref.child(ref.getAuth().uid);\n         setUpFirebaseListen();\n       }\n     }\n     var storageChange = changes[key];\n     console.log('Storage key \"%s\" in namespace \"%s\" changed. ' +\n       'Old value was \"%s\", new value is \"%s\".',\n       key,\n       namespace,\n       storageChange.oldValue,\n       storageChange.newValue);\n   }\n });\n\n chrome.storage.sync.get('firebase-url', function(items) {\n   if (items['firebase-url'] !== undefined) {\n     setUpFirebase(items['firebase-url']);\n     if (ref.getAuth() === null) {\n       showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n     } else {\n       userRef = ref.child(ref.getAuth().uid);\n       setUpFirebaseListen();\n     }\n   }\n });\n\n function authenticate(email, pass) {\n   console.log('Authing: ' + ref);\n   ref.authWithPassword({\n     'email': email,\n     'password': pass\n   }, function(error, authData) {\n     if (error) {\n       console.log('Login Failed!', error);\n       //return false;\n     } else {\n       console.log('Authenticated successfully with payload:', authData);\n       userRef = ref.child(ref.getAuth().uid);\n       setUpFirebaseListen();\n       showSystemNotif('basic', 'images/icon-128.png', 'Succesful Authentication', 'You will now receive notifications from attatched devices', null);\n       //return true;\n     }\n   });\n }\n\n function unAuthenticate() {\n   ref.unauth();\n }\n"]}