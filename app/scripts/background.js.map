{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":[" /* exported authenticate, unAuthenticate */\n 'use strict';\n\n var ref, userRef;\n\n Firebase.enableLogging(false);\n\n function showSystemNotif(type, iconUrl, title, message, callback) {\n   var notifId = {\n     'type': 'system'\n   };\n   var options = {\n     'type': type,\n     'iconUrl': iconUrl,\n     'title': title,\n     'message': message\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, callback);\n }\n\n chrome.notifications.onClicked.addListener(function(notificationId) {\n   var notifObj = JSON.parse(notificationId);\n   if (notifObj.type === 'device_notif') {\n     //userRef.child('notifications/' + notifObj.fbId).remove();\n   }\n });\n\n chrome.notifications.onButtonClicked.addListener(function(notificationId, buttonIndex) {\n   var notifObj = JSON.parse(notificationId);\n   if (notifObj.type === 'device_notif') {\n     if (buttonIndex === 0) {\n       userRef.child('notifications/' + notifObj.fbId).remove();\n     } else if (buttonIndex === 1) {\n       userRef.child('notifications/' + notifObj.fbId).once('value', function(dataSnapshot) {\n         userRef.child('ignored_apps/' + dataSnapshot.child('package').val()).set(true);\n       });\n     }\n   }\n });\n\n function onNewNotification(childSnapshot) {\n   console.log(childSnapshot);\n   //showNotif('basic', 'images/icon-128.png', childSnapshot.child('title').val(), childSnapshot.child('text').val(), null);\n   var notifId = {\n     'type': 'device_notif',\n     'fbId': childSnapshot.key()\n   };\n   var title = childSnapshot.child('title').val();\n   var text = childSnapshot.child('text').val();\n   var options = {\n     'type': 'basic',\n     'iconUrl': 'images/icon-128.png',\n     'title': title !== null ? title : '',\n     'message': text !== null ? text : '',\n     'buttons': [{\n       'title': 'Dismiss'\n     }, {\n       'title': 'Ignore from this app'\n     }]\n   };\n   chrome.notifications.create(JSON.stringify(notifId), options, null);\n }\n\n function setUpFirebase(url) {\n   console.log(ref);\n   console.log(url);\n   ref = new Firebase(url);\n }\n\n function setUpFirebaseListen() {\n   if (ref !== undefined) {\n     userRef.child('notifications').off('child_added', onNewNotification);\n     userRef.child('notifications').on('child_added', onNewNotification);\n   }\n }\n\n chrome.runtime.onInstalled.addListener(details => {\n   console.log('previousVersion', details.previousVersion);\n });\n\n // chrome.browserAction.setBadgeText({\n //   text: 'Notiforward'\n // });\n\n // chrome.storage.onChanged.addListener(function(changes, namespace) {\n //   for (var key in changes) {\n //     if (key === 'firebase-url') {\n //       setUpFirebase(changes[key].newValue);\n //       if (ref.getAuth() === null) {\n //         showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n //       } else {\n //         userRef = ref.child(ref.getAuth().uid);\n //         setUpFirebaseListen();\n //       }\n //     }\n //     var storageChange = changes[key];\n //     console.log('Storage key \"%s\" in namespace \"%s\" changed. ' +\n //       'Old value was \"%s\", new value is \"%s\".',\n //       key,\n //       namespace,\n //       storageChange.oldValue,\n //       storageChange.newValue);\n //   }\n // });\n\n chrome.storage.sync.get('firebase-url', function(items) {\n   console.log('syncing settings');\n   if (items['firebase-url'] !== undefined) {\n     setUpFirebase(items['firebase-url']);\n     if (ref.getAuth() === null || ref.getAuth() === undefined) {\n       showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n     } else {\n       userRef = ref.child(ref.getAuth().uid);\n       setUpFirebaseListen();\n     }\n   } else {\n     showSystemNotif('basic', 'images/icon-128.png', 'Authentication Error', 'Please log into your Firebase DB', null);\n   }\n });\n\n function authenticate(fDb, fUrl, email, pass, $result) {\n   ref = new Firebase(fUrl);\n   console.log('Authing: ' + ref);\n   ref.authWithPassword({\n     'email': email,\n     'password': pass\n   }, function(error, authData) {\n     if (error) {\n       ref = undefined;\n       console.log('Login Failed!', error);\n       $result.html('Authentication Failed');\n     } else {\n       var storages = {\n         'firebase-db': fDb,\n         'firebase-url': fUrl,\n         'firebase-email': email\n       };\n       console.log('Authenticated successfully with payload:', authData);\n       chrome.storage.sync.set(storages, function() {\n         // Notify that we saved.\n         console.log('Settings saved');\n         console.log(storages);\n       });\n       userRef = ref.child(ref.getAuth().uid);\n       showSystemNotif('basic', 'images/icon-128.png', 'Succesful Authentication', 'You will now receive notifications from attatched devices', null);\n       $result.html('Successful Authentication');\n       setUpFirebaseListen();\n     }\n   });\n }\n\n function unAuthenticate(wind) {\n   console.log('unauthing');\n   ref.unauth();\n   ref = undefined;\n   userRef = undefined;\n   chrome.storage.sync.remove(['firebase-db', 'firebase-url', 'firebase-email'], function() {\n     console.log('storage removed');\n   });\n   showSystemNotif('basic', 'images/icon-128.png', 'Notiforward Unauthenticated', 'You will no longer receive notifications on this device', null);\n   wind.close();\n }\n"]}